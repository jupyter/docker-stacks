name: Load Docker image
description: Download image artifact and load it to docker

inputs:
  image:
    description: Image name
    required: true
    type: string
  platform:
    description: Image platform
    required: true
    type: string

runs:
  using: composite
  steps:
    # Self-hosted runners share a state (whole VM) between runs
    - name: Cleanup unwanted docker images ğŸ—‘ï¸
      run: docker system prune --all --force
      shell: bash

    - name: Download built image ğŸ“¥
      uses: actions/download-artifact@v3
      with:
        name: ${{ inputs.image }}-${{ inputs.platform }}
        path: /tmp/
    - name: Load downloaded image to docker ğŸ“¥
      run: |
        docker load --input /tmp/${{ inputs.image }}-${{ inputs.platform }}.tar
        docker image ls -a
      shell: bash
    - name: Delete the file ğŸ—‘ï¸
      run: rm -f /tmp/${{ inputs.image }}-${{ inputs.platform }}.tar
      shell: bash
      if: always()
